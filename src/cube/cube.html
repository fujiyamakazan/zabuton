<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://unpkg.com/three@0.131.3/build/three.min.js"></script>
<script
	src="https://unpkg.com/three@0.131.3/examples/js/controls/OrbitControls.js"></script>
<script src="https://code.createjs.com/tweenjs-0.6.2.min.js"></script>
<!--
<script src="./TextGeometry.js"></script>
<script src="./FontLoader.js"></script>
 -->

<script>

window.addEventListener('DOMContentLoaded', init);

var existX = 0;
var existY = 0;
var existZ = 0;
var pieces = [];

var command = ''

function init() {

	$("#command").focus();

	/* ãƒ¬ãƒ³ãƒ€ãƒ© */
	const width = 300;
	const height = 300;
	const renderer = new THREE.WebGLRenderer({
		canvas : document.querySelector('#canvasCube'),
		alpha : true
	});
	renderer.setSize(width, height);
	renderer.setPixelRatio(window.devicePixelRatio);

	/* ã‚·ãƒ¼ãƒ³ */
	const scene = new THREE.Scene();

	/* ã‚°ãƒªãƒƒãƒ‰ */
	var cube_size = 100;
	var grid_count = 10;
	var grid_size = grid_count * cube_size;
	var grid = new THREE.GridHelper(grid_size, grid_count);
	grid.material.color = new THREE.Color(0xaaaaaa);
	scene.add(grid);

	/* ã‚«ãƒ¡ãƒ© */
	const camera = new THREE.PerspectiveCamera(45, width / height, 1, 10000);
	const cameraX = 500;
	const cameraY = 500;
	const cameraZ = 1000;
	camera.position.set(cameraX, cameraY, cameraZ);
	camera.lookAt(new THREE.Vector3(0, 0, 0));

    /* ã‚¬ã‚¤ãƒ‰ */
    const loader = new THREE.FontLoader();
    loader.load('https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/fonts/helvetiker_regular.typeface.json', (font) => {
	    function CreateText(word, x, y, z){
	        const textGeometry = new THREE.TextGeometry(word, {
	            font: font,
	            size: 100,
	            height: 10,
	            });
	        const textMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
	        const textMesh = new THREE.Mesh(textGeometry, textMaterial);
	        textMesh.position.set(x, y, z);
	        return textMesh;
	    }

	    scene.add(CreateText("U", 0, 300, 0));
	    scene.add(CreateText("F", 0, 0, 300));
	    scene.add(CreateText("L", -300, 0, 0));
	    scene.add(CreateText("R", 300, 0, 0));
	    scene.add(CreateText("B", 0, 0, -300));
	    scene.add(CreateText("D", 0, -300, 0));
    });

    /* ãƒ©ã‚¤ãƒˆ */
    const light = new THREE.DirectionalLight(0xFFFFFF);
    const light2 = new THREE.DirectionalLight(0xFFFFFF);
    light.position.set(100, 100, 100); // ãƒ©ã‚¤ãƒˆã®æ–¹å‘
    light2.position.set(-100, -100, -100); // ãƒ©ã‚¤ãƒˆã®æ–¹å‘
    scene.add(light);
    scene.add(light2);
    $('#lightUp').on('click', function() {
        light.intensity = 2; // æ˜ã‚‹ã•200%
        light2.intensity = 2; // æ˜ã‚‹ã•200%
    });
    $('#lightDown').on('click', function() {
        light.intensity = 1;
        light2.intensity = 1;
    });

    /* ãƒã‚¦ã‚¹ã®ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã«ã‚ˆã‚‹ã‚«ãƒ¡ãƒ©æ“ä½œ */
    const controls = new THREE.OrbitControls(camera, renderer.domElement);

    /* ã‚­ãƒ¥ãƒ¼ãƒ–ç”¨é€éç´ æ */
    const basicMate = new THREE.MeshBasicMaterial({color : 0xFFFFFF});
    basicMate.opacity = 0.1; // é€éè¨­å®š
    basicMate.transparent = true; // é€éè¨­å®š
    basicMate.depthTest = false; // é€éè¨­å®š

    /* ã‚­ãƒ¥ãƒ¼ãƒ–(ç¨¼åƒéƒ¨åˆ†) */
    const basicBox = new THREE.BoxGeometry(400, 400, 400);
    var cube = new THREE.Mesh(basicBox, basicMate);
    scene.add(cube);

    /* ã‚­ãƒ¥ãƒ¼ãƒ–ï¼ˆå›ºå®šéƒ¨åˆ†ï¼‰*/
    var cubeFix = new THREE.Mesh(basicBox, basicMate);
    scene.add(cubeFix);

	/* ãƒ”ãƒ¼ã‚¹ */
	function createPiece(x, y, z) {
		var materials = [
	        new THREE.MeshLambertMaterial({color : 0x000000}), // Ré¢
	        new THREE.MeshLambertMaterial({color : 0x000000}), // Lé¢
	        new THREE.MeshLambertMaterial({color : 0x000000}), // Ué¢
	        new THREE.MeshLambertMaterial({color : 0x000000}), // Dé¢
	        new THREE.MeshLambertMaterial({color : 0x000000}), // Fé¢
	        new THREE.MeshLambertMaterial({color : 0x000000}) // Bé¢
	    ];
		if (x == 100) {
			materials[0] = new THREE.MeshLambertMaterial({color : 0xFF0000}); // Ré¢èµ¤
		}
        if (x == -100) {
            materials[1] = new THREE.MeshLambertMaterial({color : 0xF58220}); // Lé¢æ©™
        }
        if (y == 100) {
            materials[2] = new THREE.MeshLambertMaterial({color : 0xFFD800}); // Ué¢é»„
        }
        if (y == -100) {
            materials[3] = new THREE.MeshLambertMaterial({color : 0xFFFFFF}); // Dé¢ç™½
        }
        if (z == 100) {
            materials[4] = new THREE.MeshLambertMaterial({color : 0x0000FF}); // Fé¢é’
        }
        if (z == -100) {
            materials[5] = new THREE.MeshLambertMaterial({color : 0x009944}); //  Bé¢ç·‘
        }

		var material = new THREE.MeshFaceMaterial(materials);
		var mesh = new THREE.Mesh(new THREE.BoxGeometry(95, 95, 95), material);
		mesh.position.set(x, y, z);
		return mesh;
	}

	pieces.push(createPiece(-100, 100, -100)); // BUL
	pieces.push(createPiece(0, 100, -100)); // BU
	pieces.push(createPiece(100, 100, -100)); // BUR

	pieces.push(createPiece(-100, 0, -100)); // BL
	pieces.push(createPiece(0, 0, -100)); // B
	pieces.push(createPiece(100, 0, -100)); // BR

	pieces.push(createPiece(-100, -100, -100)); // BDL
	pieces.push(createPiece(0, -100, -100)); // BD
	pieces.push(createPiece(100, -100, -100)); // BDR

	pieces.push(createPiece(-100, 100, 0)); // UL
	pieces.push(createPiece(0, 100, 0)); // U
	pieces.push(createPiece(100, 100, 0)); // UR

	pieces.push(createPiece(-100, 0, 0)); // L
	pieces.push(createPiece(0, 0, 0));
	pieces.push(createPiece(100, 0, 0)); // R

	pieces.push(createPiece(-100, -100, 0)); // DL
	pieces.push(createPiece(0, -100, 0)); // D
	pieces.push(createPiece(100, -100, 0)); // DR

	pieces.push(createPiece(-100, 100, 100)); // FUL
	pieces.push(createPiece(0, 100, 100)); // FU
	pieces.push(createPiece(100, 100, 100)); // FUR

	pieces.push(createPiece(-100, 0, 100)); // FL
	pieces.push(createPiece(0, 0, 100)); // F
	pieces.push(createPiece(100, 0, 100)); // FR

	pieces.push(createPiece(-100, -100, 100)); // FDL
	pieces.push(createPiece(0, -100, 100)); // FD
	pieces.push(createPiece(100, -100, 100)); // FDR

	pieces.forEach(function(piece, index) {
		cubeFix.add(piece);
	});



	/* å›è»¢é–¢é€£å®šæ•° */
	const angle90 = Math.PI / -2; // 90åº¦
	const step = 0.08; // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å˜ä½ã®ç§»å‹•é‡

	/* ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */
	renderer.render(scene, camera);

	function animate() {

		requestAnimationFrame(animate);

		/* ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */
		renderer.render(scene, camera);

		 /* é–¢æ•°å®šç¾© */
		function workX(flg){
			var i = flg ? 1 : -1;
			var next = angle90 * (existX + i);
			var tmp = cube.rotation.x;
			if (!flg && (tmp < next) || flg && (tmp > next)) {
				cube.rotation.x += (step * i * -1);
				return true; // ã¤ã¥ãã‚ã‚Š
			} else {
				existX += i;
				cube.rotation.x = next;
				$("#valX").text(cube.rotation.x);
				return false; // çµ‚äº†
			}
		}

		function workY(flg){
			  var i = flg ? 1 : -1;
			  var next = angle90 * (existY + i);
			  var tmp = cube.rotation.y;
			  if (!flg && (tmp < next) || flg && (tmp > next)) {
				  cube.rotation.y += (step * i * -1);
				  return true; // ã¤ã¥ãã‚ã‚Š
			  } else {
				  existY += i;
				  cube.rotation.y = next;
				  $("#valY").text(cube.rotation.y);
				  return false; // çµ‚äº†
			  }
		}

		function workZ(flg){
			  var i = flg ? 1 : -1;
			  var next = angle90 * (existZ + i);
			  var tmp = cube.rotation.z;
			  if (!flg && (tmp < next) || flg && (tmp > next)) {
				  cube.rotation.z += (step * i * -1);
				  return true; // ã¤ã¥ãã‚ã‚Š
			  } else {
				  existZ += i;
				  cube.rotation.z = next;
				  $("#valZ").text(cube.rotation.z);
				  return false; // çµ‚äº†
			  }
		}

		function getWorldEulerAngles(object) {
			const rotation = new THREE.Euler();
			object.getWorldQuaternion(rotation); // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ¯ãƒ¼ãƒ«ãƒ‰åº§æ¨™ç³»ã§ã®å›è»¢ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‚’å–å¾—
			return rotation.toVector3(); // ã‚ªã‚¤ãƒ©ãƒ¼è§’ã«å¤‰æ›
		}

		function convert(piece, from, to){
			var worldPos = piece.getWorldPosition(new THREE.Vector3());
			var wPx = worldPos.x;
			var wPy = worldPos.y;
			var wPz = worldPos.z;
			var worldRot = getWorldEulerAngles(piece);
			var wRx = worldRot.x;
			var wRy = worldRot.y;
			var wRz = worldRot.z;

			from.remove(piece);
			to.add(piece);

			piece.position.x = wPx;
			piece.position.y = wPy;
			piece.position.z = wPz;
			piece.rotation.x = wRx;
			piece.rotation.y = wRy;
			piece.rotation.z = wRz;
		}

		function combineALL(){
			pieces.forEach(function(piece, index) {
				convert(piece, cubeFix, cube);
			});
		}

		function combineR(){
			pieces.forEach(function(piece, index) {
				//console.log(piece.position.x);
				if (piece.position.x > 90) {
					convert(piece, cubeFix, cube);
				}
			});
		}

		function combineL(){
			pieces.forEach(function(piece, index) {
				if (piece.position.x < -90) {
					convert(piece, cubeFix, cube);
				}
			});
		}

		function combineU(){
			pieces.forEach(function(piece, index) {
				if (piece.position.y > 90) {
					convert(piece, cubeFix, cube);
				}
			});
		}

		function combineD(){
			pieces.forEach(function(piece, index) {
				if (piece.position.y < -90) {
					convert(piece, cubeFix, cube);
				}
			});
		}

		function combineF(){
			pieces.forEach(function(piece, index) {
				if (piece.position.z > 90) {
					convert(piece, cubeFix, cube);
				}
			});
		}

		function combineB(){
			pieces.forEach(function(piece, index) {
				if (piece.position.z < -90) {
					convert(piece, cubeFix, cube);
				}
			});
		}

		/* ã‚³ãƒãƒ³ãƒ‰ã®èª­å–ã‚Š */
		if (command == ''){

			/* 1æ–‡å­—åˆ†ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å–å¾—ã™ã‚‹ */
			if ($("#command").val().length > 0) {
				command = $("#command").val().charAt(0);
			}

			/* è¦–ç‚¹ãƒªã‚»ãƒƒãƒˆ */
			if (command == '0') {
			    // å‡¦ç†ãªã—
			}

			/* Xè»¸æ­£å›è»¢(L'/R) */
			if (command == 'x') {
				combineALL();
			}
			/* Xè»¸é€†å›è»¢(L/R') */
			if (command == 'X') {
				combineALL();
			}
			/* Yè»¸æ­£å›è»¢(U/D') */
			if (command == 'y') {
				combineALL();
			}
			/* Yè»¸é€†å›è»¢(U'/D) */
			if (command == 'Y') {
				combineALL();
			}
			/* Zè»¸æ­£å›è»¢(F/B') */
			if (command == 'z') {
				combineALL();
			}
			/* Zè»¸é€†å›è»¢(F'/B) */
			if (command == 'Z') {
				combineALL();
			}
			/* R/R' */
			if (command == 'r' || command  == 'R') {
				combineR();
			}
			/* L/L' */
			if (command == 'l' || command  == 'L') {
				combineL();
			}
			/* U/U' */
			if (command == 'u' || command  == 'U') {
				combineU();
			}
			/* D/D' */
			if (command == 'd' || command  == 'D') {
				combineD();
			}
			/* F/F' */
			if (command == 'f' || command  == 'F') {
				combineF();
			}
			/* B/B' */
			if (command == 'b' || command  == 'B') {
				combineB();
			}

			/* 1æ–‡å­—åˆ†ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ¶ˆã™ */
		    if ($("#command").val().length > 0) {
		        var tmp = $("#command").val().slice(1);
		        $("#command").val(tmp);
		    }
			return;
		}
		//alert(command);ruRU

		var hasNext = false;

		/* Xè»¸æ­£å›è»¢(L'/R) */
		if (command == 'x') {
			hasNext = workX(true);
		}
		/* Xè»¸é€†å›è»¢(L/R') */
		if (command == 'X') {
			hasNext = workX(false);
		}
		/* Yè»¸æ­£å›è»¢(U/D') */
		if (command == 'y') {
			hasNext = workY(true);
		}
		/* Yè»¸é€†å›è»¢(U'/D) */
		if (command == 'Y') {
			hasNext = workY(false);
		}
		/* Zè»¸æ­£å›è»¢(F/B') */
		if (command == 'z') {
			hasNext = workZ(true);
		}
		/* Zè»¸é€†å›è»¢(F'/B) */
		if (command == 'Z') {
			hasNext = workZ(false);
		}
		/* R/R' */
		if (command == 'r') {
			hasNext = workX(true);
		}
		if (command  == 'R') {
			hasNext = workX(false);
		}
		/* L/L' */
		if (command == 'l') {
			hasNext = workX(false);
		}
		if (command  == 'L') {
			hasNext = workX(true);
		}
		/* U/U' */
		if (command == 'u') {
			hasNext = workY(true);
		}
		if (command  == 'U') {
			hasNext = workY(false);
		}
		/* D/D' */
		if (command == 'd') {
			hasNext = workY(false);
		}
		if (command  == 'D') {
			hasNext = workY(true);
		}
		/* F/F' */
		if (command == 'f') {
			hasNext = workZ(true);
		}
		if (command  == 'F') {
			hasNext = workZ(false);
		}
		/* B/B' */
		if (command == 'b') {
			hasNext = workZ(false);
		}
		if (command  == 'B') {
			hasNext = workZ(true);
		}

		/* è¦–ç‚¹ãƒªã‚»ãƒƒãƒˆ */
		if (command  == '0') {
			camera.position.set(cameraX, cameraY, cameraZ);
			camera.lookAt(new THREE.Vector3(0, 0, 0));
		}


		if(command != "" && hasNext == false){
			command = ""; // ã‚³ãƒãƒ³ãƒ‰åˆæœŸåŒ–

			pieces.forEach(function(piece, index) {
				convert(piece, cube, cubeFix);
			});

			cube.position.x = 0;
			cube.position.y = 0;
			cube.position.z = 0;
			cube.rotation.x = 0;
			cube.rotation.y = 0;
			cube.rotation.z = 0;

			existX = 0;
			existY = 0;
			existZ = 0;

			/* ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚° */
			renderer.render(scene, camera);

		}
	} // animate
	animate();

	/* ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼åˆ¶å¾¡ */
	$(window).keyup(function(e){
	      if(e.keyCode == 48){ // 0
	    	  $("#command").val("0");
	      }

	      if(e.keyCode == 37){ // â†
	    	  $("#command").val("Z");
	      }
             if(e.keyCode == 38){ // â†‘
                 $("#command").val("x");
             }
	      if(e.keyCode == 39){ // â†’
	    	  $("#command").val("z");
	      }
	      if(e.keyCode == 40){ // â†“
                 $("#command").val("X");
             }

             if(e.keyCode == 100){ // ãƒ†ãƒ³ã‚­ãƒ¼4
                 $("#command").val("y");
             }
             if(e.keyCode == 102){ // ãƒ†ãƒ³ã‚­ãƒ¼6
                 $("#command").val("Y");
             }

             if(e.keyCode == 105){ // ãƒ†ãƒ³ã‚­ãƒ¼9
                 $("#command").val("r");
             }
             if(e.keyCode == 99){ // ãƒ†ãƒ³ã‚­ãƒ¼3
                 $("#command").val("R");
             }

             if(e.keyCode == 103){ // ãƒ†ãƒ³ã‚­ãƒ¼7
                 $("#command").val("L");
             }
             if(e.keyCode == 97){ // ãƒ†ãƒ³ã‚­ãƒ¼1
                 $("#command").val("l");
             }

             if(e.keyCode == 104){ // ãƒ†ãƒ³ã‚­ãƒ¼8
                 $("#command").val("u");
             }
             if(e.keyCode == 101){ // ãƒ†ãƒ³ã‚­ãƒ¼5
                 $("#command").val("U");
             }

             if(e.keyCode == 98){ // ãƒ†ãƒ³ã‚­ãƒ¼2
                 $("#command").val("D");
             }
             if(e.keyCode == 96){ // ãƒ†ãƒ³ã‚­ãƒ¼0
                 $("#command").val("d");
             }

             if(e.keyCode == 111){ // ãƒ†ãƒ³ã‚­ãƒ¼/
                 $("#command").val("f");
             }
             if(e.keyCode == 106){ // ãƒ†ãƒ³ã‚­ãƒ¼*
                 $("#command").val("F");
             }

	  });
}

function Shuffle(){
    const characters = 'rRlLuUdDfFbB';
    let randomString = '';
    for (let i = 0; i < 10; i++) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        randomString += characters.charAt(randomIndex);
    }
    $("#command").val(randomString);
}
function SetCommand(cmd){
    $("#command").val(cmd);
}

</script>
</head>
<body style="background-color: black;">
	<input type="text" id="command" /><br>
    <button onclick="location.reload();">Reset</button>
    <button onclick="Shuffle();">Shuffle</button>
    <br>
    <button onclick="SetCommand('x');">X</button><button onclick="SetCommand('X');">X'</button>
    <button onclick="SetCommand('y');">Y</button><button onclick="SetCommand('Y');">Y'</button>
    <button onclick="SetCommand('z');">Z</button><button onclick="SetCommand('Z');">Z'</button>
    <br>
    <button onclick="SetCommand('r');">R</button><button onclick="SetCommand('R');">R'</button>
    <button onclick="SetCommand('XrL');">M</button><button onclick="SetCommand('xRl');">M'</button>
    <button onclick="SetCommand('l');">L</button><button onclick="SetCommand('L');">L'</button>
    <br>
    <button onclick="SetCommand('u');">U</button><button onclick="SetCommand('U');">U'</button>
    <button onclick="SetCommand('YuD');">E</button><button onclick="SetCommand('yUd');">E'</button>
    <button onclick="SetCommand('d');">D</button><button onclick="SetCommand('D');">D'</button>
    <br>
    <button onclick="SetCommand('f');">F</button><button onclick="SetCommand('F');">F'</button>
    <button onclick="SetCommand('ZfB');">S</button><button onclick="SetCommand('ZFb');">S'</button>
    <button onclick="SetCommand('b');">B</button><button onclick="SetCommand('B');">B'</button>
    <br>
    <button onclick="SetCommand('xl');">Rw</button><button onclick="SetCommand('XL');">R'w</button>
    <button onclick="SetCommand('yd');">Uw</button><button onclick="SetCommand('YD');">U'w</button>
    <button onclick="SetCommand('zb');">Fw</button><button onclick="SetCommand('ZB');">F'w</button>
    <br>
    <button id="lightUp">ğŸ’¡+</button><button id="lightDown">ğŸ’¡-</button><br>
	<canvas id="canvasCube"></canvas>
	<!--
	<p style="background-color: white;">

		<span>Xè»¸å›è»¢ï¼š</span><span id="valX"></span><br>
		<span>Yè»¸å›è»¢ï¼š</span><span id="valY"></span><br>
		<span>Zè»¸å›è»¢ï¼š</span><span id="valZ"></span><br>
		<span>cubeã®çŠ¶æ…‹ï¼š</span><span id="infoCube"></span><br>
		<span>cubeFixã®çŠ¶æ…‹ï¼š</span><span id="infoCubeFix"></span><br>
		<span>FDRã®çŠ¶æ…‹ï¼š</span><span id="infoFdr"></span><br>
		<span>worldã®çŠ¶æ…‹ï¼š</span><span id="infoWorld"></span><br>

	</p>
	-->

</body>
</html>
